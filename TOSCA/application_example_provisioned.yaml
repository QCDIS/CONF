tosca_definitions_version: "tosca_simple_yaml_1_0"
topology_template:
  node_templates:
    compute:
      properties:
        disk_size: "50000 MB"
        mem_size: "6000 MB"
        num_cores: 2.0
        os: "Ubuntu 18.04"
        user_name: "vm_user"
      interfaces:
        Standard:
          create: "dumy.yaml"
      type: "tosca.nodes.ARTICONF.VM.Compute"
      attributes:
        user_key_pair:
          protocol: "ssh"
          keys:
            public_key: "c3NoLXJzYSBBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFBZ1FDV3l6VEoxS1pycDVvVHVBVm15dmxKL2prMnRNdktZSlAvSWtHZ1JKeTVFNUgrbjl0eU1QRXdyUDN4c0lUMVZzRjlVNVhLTkkvVDVpZDgxNko5RmxjbEhOSHVrbEFTMlhqV3QzNnlZekorMkhsa3JET0I4Q25DdmgvQlQ5K2liNkpjVFpUd21Xb1FQbjFuVXpSelRSVGU5NUlyOUl4djgrTnNLVWYxdVYzNDBRPT0gYXV0byBnZW5lcmF0ZWQgdXNlciBhY2NlZXMga2V5cwo="
            private_key: "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlDV3dJQkFBS0JnUUNXeXpUSjFLWnJwNW9UdUFWbXl2bEovamsydE12S1lKUC9Ja0dnUkp5NUU1SCtuOXR5Ck1QRXdyUDN4c0lUMVZzRjlVNVhLTkkvVDVpZDgxNko5RmxjbEhOSHVrbEFTMlhqV3QzNnlZekorMkhsa3JET0IKOENuQ3ZoL0JUOStpYjZKY1RaVHdtV29RUG4xblV6UnpUUlRlOTVJcjlJeHY4K05zS1VmMXVWMzQwUUlEQVFBQgpBb0dBSUJDMStQVXZMbFZGZmt2eldoaHZTankxRGQwRU9OU3dvK0EwOUUraXcvaFZZeis2K2wxTjdIdmN4RGcxCkRiYVZEb0ZucU1ma2picXpTdWpQdEttN2ZlVThldjF3a21aOHNRdzhac1JNdXd3NUxDUzZpMENnem5RMlJ3WmIKU2dqSlVrLy81VVF2Z2x2YkFEMXJpUlJ1TzR5N0cwTFZpa2Y4b3UvM0pBM21iQUVDUVFESm1VY2dBQjJONmpSYQpydWxhNklnYzFYYjdTUGl0TEpFQjFNZytyUW5EZDZWWXZqcVVGaW9zWVdhYlJSdGtPQ1VPdWt5cklLY1puZ3Q4CjdrdHN6T1c1QWtFQXYzeEFHYUdyWkk1KzdjSTF4Si9NaWVRa1pkaFFWTEpEUnpwT3FJVjVKaFIzbCt2R3N2R2MKWWhwUG9IL1VoN3hsV3NLUVF2Q3Y2azhyaVh1dmZ6aTMyUUpBQTJDb0NtYzJGNHlXOS9YNlB1V3FjaUU1YnhoWAo0ajdlNXhMemorbENRcDRjalJJUzFTeFI1SkIxTWFERXhyY1NGOThUTGNMTVNlZVY5YS9nWDZCSE1RSkFadHNVCkIzQ2JBdW16N255cXF4SjNLUDUrT3FLbUM4aXhjTm8yRkRtVjZNbUhyL2c3QkRYYUhhd3FaM2tpclVLYVl0VXQKN25jZzEwaHRoMjBEeU4rcmlRSkFRMHVvNW9HaUxJSHNEQUR5Nkw1azdrNTZjVUlhZnhpeVRHdzlWQ2tUY3puVQpPS1liYXFVM3lyaDRqbzRYTHlGd3JYcHJOdkNsb29pY1JIMTdSUkMxUHc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo="
        public_ip: "192.125.18.246"
        role: "master"
        node_type: "t2.medium"
        root_key_pair:
          protocol: "ssh"
          keys:
            public_key: "cHVibGljS2V5LTM5NjBjZThjLTA0NzctNDcyNC1iZTc5LWM5NGNjZjQ1ZDYwZg=="
            private_key: "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBbnFVd3E3ZHdvWjJjcU03WSsrcGRia0Jud0dFc1FEVExQdWxQWklQMm5UcUo3L05aTlQzMU9uM1hRMElsCkNENFNLekxyVE04ZGlIVEJRRlBQZTV6UHB6Q1Uyam82SDcxL0xUTDRnZDZPakxreFkwS2p5SWZwbFJUcHhpUnpldXVJVG9wLzdLZWoKMjMyWVQ4QXowQU03SStQZVFwb0l1RjhQeHBOdlpnOUZvYWlMd09iL2lwSFV0ZlNjUTRzZEhPTHlCU1h3N1RIQ2VkNHowazRpckhpbQpMTlJHRFZJenNpZDM4T0hRYnFna2pPZUJBaFVoUm5oKzAwWmVYb2NER2o3bUZGWGxuYkhzeGNzTGx3NlM0V1NsR0RPalhPRFRvRE5ICkNmMUkycUdtSWM0VXovckR4TSs5Q3JQYlhBMnNHd1RIV0paM1ZENUtzWmFWSEkzTlp2K3ZBUUlEQVFBQkFvSUJBQVJZVyt2b0cxS2gKNFgrU0lzbExrd0dKREE1dDJ1dHJSc0hUWEJSUnRQaDdlUG0wZlpZQ3UydTl0SjZuK2lHdXFZcTdXMHlBUTd2UUR0YjNOTENiQytqMQpZSzVWZC9BVW5aNGNUa2dvVTFreFhWUHRxRlMrdkR3VUZZOFN3b0wwWG9oZ0xMN0xuS1pQVzFPYjNROXVkemsxYlluL2RBdXd0dHJtCmdOK1h2WDErK0REQnVlTnZaTGF1Q3puUmt2WDZzVHd3alFGQVlLUGZ2Z1A1UUVCMHRkN0Nkb215TW1GL2NVdThEajhXaldtNlpRZFcKNTIrNFRwdE4rVjhoTjdIM3RKRXZ2dHN5S3lCYzZWUW4wNnZ4WGh5QktpVko3M0puQnpyREd2ODI4YU84REVUS2hidUpTMjJzQTF6SApBVEh1b045WUw1bzAyYW5ycTRyUGt1NHBJUTBDZ1lFQTRhYU5sQW81bVA4MGMybXRZazE1dXdudG5UWnJmZnBKNGxZaWtUSkw3YlVpCnRvWk1KRmwyK1k5Q2ZZK2hTYnk4RzlWd01jWEpiUzBTZitKU3ZqQ0p1WTZNQ2dCNTM4RU5MekpwK3FJZXJwd05WY1pMSFRycElUaWIKM21qdEEwWUttUk16bGJYTVlNeEV5Rll4N3pRbWJMQmFJSEkwdWYzOWZLU2M0OU9pMks4Q2dZRUFzL3VPUFVVZUtwYld0T3dCMS9mUwpTei8rSEdmK25nYmVvMk4xamhpaERQa2t3UDVLWFBseURtYVFXZnRMUFhjUGVnamJUaHkrdGR1K2lsTlV6NmQ1eExZNzhreCtVTlErCitYcE1leStVWlN6UWZ5ZWR2SjlwQVhybjhIVzFGYlpNcm9oVEE0ek1kUkJ5b29iZ0ticUtHRE5zUkVsZkF4MDdDMGR2S3FYQWYwOEMKZ1lBYTVjT1NsZlZ2cTF3Uk5kT1pHQ3NlaEh4eWRQNHpNaGFFaUVmdWp0UkdMWVZKeEpCbTlOTWR4Rm5rcGE1UUg5TThiaURGamhJSQpsWXJTKzZOcFVGZmFhb2QrMmJldFdGRytBb0JuZzlPc2RLV1NSK1RFUXpWdTVGU1FHbW5HTGg4dFNBQ3FJOVdNNUV4K3BPZW0zOHlFCndEQytGVjc3bks4T29JQ2pGNk1kdVFLQmdCRWVGcXdiRzhCZk1qSm8wOUFQZ00rcFdXaW9OMTRlTnlTQS9CZzBuWFNYYVhoMWR1c2EKeWs4MlQvcE8zUndPYThsbWVEMFluTWE5RElVcFljS1NJaEdrWjFVbkUwaHF0MGFRN0I4M0tqenBJemRFdEVyUk9uSnFsdzZXazA5cQpWQ2F4VG52aTh6c2JBbHdVeWRNT0s3NGJmZXVNc3QyZjlSS2dpNkVadkpJZkFvR0JBS3BaWjRnb1I4ZFVFSTJJQm9zNjdCNExia1JVCll5elg2RFZrcEd5MzMvYVIyRUtHZ0ZGenNnS2I1K204dFhOM1lRTFhxbGJNTU1Oakx2eVVZdk53dzQzLzVvRHhhbGxIa3c2dW1BWDgKbkhtOGFmajYyTzVrREhsRUcrZDdCQTVqMHhyeGxnM1J4S0xvcXBoSnNKTWVFYWszYVV4bXlWMkI1S3pyalg5eGZVbzcKLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0="
        host_name: "vm0"
    compute_1:
      properties:
        disk_size: "50000 MB"
        mem_size: "6000 MB"
        num_cores: 2.0
        os: "Ubuntu 18.04"
        user_name: "vm_user"
      interfaces:
        Standard:
          create: "dumy.yaml"
      type: "tosca.nodes.ARTICONF.VM.Compute"
      attributes:
        user_key_pair:
          protocol: "ssh"
          keys:
            public_key: "c3NoLXJzYSBBQUFBQjNOemFDMXljMkVBQUFBREFRQUJBQUFBZ1FDV3l6VEoxS1pycDVvVHVBVm15dmxKL2prMnRNdktZSlAvSWtHZ1JKeTVFNUgrbjl0eU1QRXdyUDN4c0lUMVZzRjlVNVhLTkkvVDVpZDgxNko5RmxjbEhOSHVrbEFTMlhqV3QzNnlZekorMkhsa3JET0I4Q25DdmgvQlQ5K2liNkpjVFpUd21Xb1FQbjFuVXpSelRSVGU5NUlyOUl4djgrTnNLVWYxdVYzNDBRPT0gYXV0byBnZW5lcmF0ZWQgdXNlciBhY2NlZXMga2V5cwo="
            private_key: "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlDV3dJQkFBS0JnUUNXeXpUSjFLWnJwNW9UdUFWbXl2bEovamsydE12S1lKUC9Ja0dnUkp5NUU1SCtuOXR5Ck1QRXdyUDN4c0lUMVZzRjlVNVhLTkkvVDVpZDgxNko5RmxjbEhOSHVrbEFTMlhqV3QzNnlZekorMkhsa3JET0IKOENuQ3ZoL0JUOStpYjZKY1RaVHdtV29RUG4xblV6UnpUUlRlOTVJcjlJeHY4K05zS1VmMXVWMzQwUUlEQVFBQgpBb0dBSUJDMStQVXZMbFZGZmt2eldoaHZTankxRGQwRU9OU3dvK0EwOUUraXcvaFZZeis2K2wxTjdIdmN4RGcxCkRiYVZEb0ZucU1ma2picXpTdWpQdEttN2ZlVThldjF3a21aOHNRdzhac1JNdXd3NUxDUzZpMENnem5RMlJ3WmIKU2dqSlVrLy81VVF2Z2x2YkFEMXJpUlJ1TzR5N0cwTFZpa2Y4b3UvM0pBM21iQUVDUVFESm1VY2dBQjJONmpSYQpydWxhNklnYzFYYjdTUGl0TEpFQjFNZytyUW5EZDZWWXZqcVVGaW9zWVdhYlJSdGtPQ1VPdWt5cklLY1puZ3Q4CjdrdHN6T1c1QWtFQXYzeEFHYUdyWkk1KzdjSTF4Si9NaWVRa1pkaFFWTEpEUnpwT3FJVjVKaFIzbCt2R3N2R2MKWWhwUG9IL1VoN3hsV3NLUVF2Q3Y2azhyaVh1dmZ6aTMyUUpBQTJDb0NtYzJGNHlXOS9YNlB1V3FjaUU1YnhoWAo0ajdlNXhMemorbENRcDRjalJJUzFTeFI1SkIxTWFERXhyY1NGOThUTGNMTVNlZVY5YS9nWDZCSE1RSkFadHNVCkIzQ2JBdW16N255cXF4SjNLUDUrT3FLbUM4aXhjTm8yRkRtVjZNbUhyL2c3QkRYYUhhd3FaM2tpclVLYVl0VXQKN25jZzEwaHRoMjBEeU4rcmlRSkFRMHVvNW9HaUxJSHNEQUR5Nkw1azdrNTZjVUlhZnhpeVRHdzlWQ2tUY3puVQpPS1liYXFVM3lyaDRqbzRYTHlGd3JYcHJOdkNsb29pY1JIMTdSUkMxUHc9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo="
        public_ip: "192.122.56.251"
        role: "worker"
        node_type: "t2.medium"
        root_key_pair:
          protocol: "ssh"
          keys:
            public_key: "cHVibGljS2V5LTM5NjBjZThjLTA0NzctNDcyNC1iZTc5LWM5NGNjZjQ1ZDYwZg=="
            private_key: "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBbnFVd3E3ZHdvWjJjcU03WSsrcGRia0Jud0dFc1FEVExQdWxQWklQMm5UcUo3L05aTlQzMU9uM1hRMElsCkNENFNLekxyVE04ZGlIVEJRRlBQZTV6UHB6Q1Uyam82SDcxL0xUTDRnZDZPakxreFkwS2p5SWZwbFJUcHhpUnpldXVJVG9wLzdLZWoKMjMyWVQ4QXowQU03SStQZVFwb0l1RjhQeHBOdlpnOUZvYWlMd09iL2lwSFV0ZlNjUTRzZEhPTHlCU1h3N1RIQ2VkNHowazRpckhpbQpMTlJHRFZJenNpZDM4T0hRYnFna2pPZUJBaFVoUm5oKzAwWmVYb2NER2o3bUZGWGxuYkhzeGNzTGx3NlM0V1NsR0RPalhPRFRvRE5ICkNmMUkycUdtSWM0VXovckR4TSs5Q3JQYlhBMnNHd1RIV0paM1ZENUtzWmFWSEkzTlp2K3ZBUUlEQVFBQkFvSUJBQVJZVyt2b0cxS2gKNFgrU0lzbExrd0dKREE1dDJ1dHJSc0hUWEJSUnRQaDdlUG0wZlpZQ3UydTl0SjZuK2lHdXFZcTdXMHlBUTd2UUR0YjNOTENiQytqMQpZSzVWZC9BVW5aNGNUa2dvVTFreFhWUHRxRlMrdkR3VUZZOFN3b0wwWG9oZ0xMN0xuS1pQVzFPYjNROXVkemsxYlluL2RBdXd0dHJtCmdOK1h2WDErK0REQnVlTnZaTGF1Q3puUmt2WDZzVHd3alFGQVlLUGZ2Z1A1UUVCMHRkN0Nkb215TW1GL2NVdThEajhXaldtNlpRZFcKNTIrNFRwdE4rVjhoTjdIM3RKRXZ2dHN5S3lCYzZWUW4wNnZ4WGh5QktpVko3M0puQnpyREd2ODI4YU84REVUS2hidUpTMjJzQTF6SApBVEh1b045WUw1bzAyYW5ycTRyUGt1NHBJUTBDZ1lFQTRhYU5sQW81bVA4MGMybXRZazE1dXdudG5UWnJmZnBKNGxZaWtUSkw3YlVpCnRvWk1KRmwyK1k5Q2ZZK2hTYnk4RzlWd01jWEpiUzBTZitKU3ZqQ0p1WTZNQ2dCNTM4RU5MekpwK3FJZXJwd05WY1pMSFRycElUaWIKM21qdEEwWUttUk16bGJYTVlNeEV5Rll4N3pRbWJMQmFJSEkwdWYzOWZLU2M0OU9pMks4Q2dZRUFzL3VPUFVVZUtwYld0T3dCMS9mUwpTei8rSEdmK25nYmVvMk4xamhpaERQa2t3UDVLWFBseURtYVFXZnRMUFhjUGVnamJUaHkrdGR1K2lsTlV6NmQ1eExZNzhreCtVTlErCitYcE1leStVWlN6UWZ5ZWR2SjlwQVhybjhIVzFGYlpNcm9oVEE0ek1kUkJ5b29iZ0ticUtHRE5zUkVsZkF4MDdDMGR2S3FYQWYwOEMKZ1lBYTVjT1NsZlZ2cTF3Uk5kT1pHQ3NlaEh4eWRQNHpNaGFFaUVmdWp0UkdMWVZKeEpCbTlOTWR4Rm5rcGE1UUg5TThiaURGamhJSQpsWXJTKzZOcFVGZmFhb2QrMmJldFdGRytBb0JuZzlPc2RLV1NSK1RFUXpWdTVGU1FHbW5HTGg4dFNBQ3FJOVdNNUV4K3BPZW0zOHlFCndEQytGVjc3bks4T29JQ2pGNk1kdVFLQmdCRWVGcXdiRzhCZk1qSm8wOUFQZ00rcFdXaW9OMTRlTnlTQS9CZzBuWFNYYVhoMWR1c2EKeWs4MlQvcE8zUndPYThsbWVEMFluTWE5RElVcFljS1NJaEdrWjFVbkUwaHF0MGFRN0I4M0tqenBJemRFdEVyUk9uSnFsdzZXazA5cQpWQ2F4VG52aTh6c2JBbHdVeWRNT0s3NGJmZXVNc3QyZjlSS2dpNkVadkpJZkFvR0JBS3BaWjRnb1I4ZFVFSTJJQm9zNjdCNExia1JVCll5elg2RFZrcEd5MzMvYVIyRUtHZ0ZGenNnS2I1K204dFhOM1lRTFhxbGJNTU1Oakx2eVVZdk53dzQzLzVvRHhhbGxIa3c2dW1BWDgKbkhtOGFmajYyTzVrREhsRUcrZDdCQTVqMHhyeGxnM1J4S0xvcXBoSnNKTWVFYWszYVV4bXlWMkI1S3pyalg5eGZVbzcKLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0="
        host_name: "vm1"
    kubernetes:
      properties:
        min_masters_num: 1
        min_workers_num: 1
      requirements:
      - host:
          capability: "tosca.capabilities.ARTICONF.VM.topology"
          node: "topology"
          relationship: "tosca.relationships.HostedOn"
      interfaces:
        Kubernetes:
          create:
            inputs:
              playbook: "https://raw.githubusercontent.com/skoulouzis/CONF/develop/ansible_playbooks/create_k8s.yml"
          install:
            inputs:
              playbook: "https://raw.githubusercontent.com/skoulouzis/CONF/develop/ansible_playbooks/install_k8s.yml"
      type: "tosca.nodes.ARTICONF.Orchestrator.Kubernetes"
    logspout:
      properties:
        environment:
          publish: "127.0.0.1:8000:80"
        ports:
        - "8000:80"
        volumes:
        - "/etc/hostname:/etc/host_hostname:ro"
        - "/var/run/docker.sock:/var/run/docker.sock"
      requirements:
      - host:
          capability: "tosca.capabilities.ARTICONF.Orchestrator"
          node: "kubernetes"
          relationship: "tosca.relationships.HostedOn"
      type: "tosca.nodes.ARTICONF.Container.Application.Docker"
      artifacts:
        image:
          file: "gliderlabs/logspout:latest"
          repository: "docker_hub"
          type: "tosca.artifacts.Deployment.Image.Container.Docker"
    mysql:
      properties:
        environment:
          MYSQL_DATABASE: "wordpress"
          MYSQL_PASSWORD: "wordpress"
          MYSQL_ROOT_PASSWORD: "somewordpress"
          MYSQL_USER: "wordpress"
        ports:
        - "3306:3306"
        volumes:
        - "db_data:/var/lib/mysql"
      requirements:
      - host:
          capability: "tosca.capabilities.ARTICONF.Orchestrator"
          node: "kubernetes"
          relationship: "tosca.relationships.HostedOn"
      type: "tosca.nodes.ARTICONF.Container.Application.Docker"
      artifacts:
        image:
          file: "mysql:5.7"
          repository: "docker_hub"
          type: "tosca.artifacts.Deployment.Image.Container.Docker"
    topology:
      properties:
        domain: "Frankfurt"
        provider: "EC2"
      requirements:
      - vm:
          capability: "tosca.capabilities.ARTICONF.VM"
          node: "compute"
          relationship: "tosca.relationships.DependsOn"
      - vm:
          capability: "tosca.capabilities.ARTICONF.VM"
          node: "compute_1"
          relationship: "tosca.relationships.DependsOn"
      interfaces:
        CloudsStorm:
          provision:
            inputs:
              code_type: "SEQ"
              object_type: "SubTopology"
      type: "tosca.nodes.ARTICONF.VM.topology"
      attributes:
        credential:
          cloud_provider_name: "EC2"
          keys:
            aws_access_key_id: "XXXXXXXXXXXXXXXXXXXXXXXX"
          token: "XXXXXXXXXXXXXXXXXXXXXX"
          token_type: "access_key"
        status: "running"
  policies:
  - scalability:
      properties:
        constraint_name: "cpu_load"
        max_value: 90
      targets:
      - "mysql"
      type: "tosca.policies.ARTICONF.Performance.CPU"
  - faultTolerance:
      properties:
        level: 1
      targets:
      - "mysql"
      type: "tosca.policies.ARTICONF.FaultTolerance"
description: "TOSCA example"
imports:
- nodes: "https://raw.githubusercontent.com/skoulouzis/DRIP/develop/TOSCA/types/nodes.yaml"
- data: "https://raw.githubusercontent.com/skoulouzis/CONF/develop/TOSCA/types/data.yml"
- capabilities: "https://raw.githubusercontent.com/skoulouzis/DRIP/develop/TOSCA/types/capabilities.yaml"
- policies: "https://raw.githubusercontent.com/skoulouzis/DRIP/develop/TOSCA/types/policies.yaml"
- interfaces: "https://raw.githubusercontent.com/skoulouzis/DRIP/develop/TOSCA/types/interfaces.yml"
